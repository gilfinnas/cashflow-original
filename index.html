<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תזרים מזומנים | CashFlow Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Using Inter font as per request for modern typography, similar to SF Pro -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome for icons (sun/moon for theme toggle) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 text-slate-200 font-inter transition-colors duration-500">

    <!-- Loading Spinner -->
    <div id="loader" class="fixed inset-0 bg-slate-900 bg-opacity-90 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-blue-500"></div>
    </div>

    <!-- Support Button -->
    <a href="mailto:support@gilfinnas.com?subject=בעיה באפליקציית תזרים מזומנים&body=שלום, נתקלתי בבעיה הבאה:" class="support-button no-print" id="supportButton">
        <i class="fas fa-question-circle ml-2"></i> נתקלתם בבעיה? דברו איתנו
    </a>

    <!-- START: AI ASSISTANT -->
    <button id="ai-chat-button" title="עזרה מ-AI" class="ai-chat-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13.5l.648 1.938a3.375 3.375 0 002.672 2.672L21 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z" />
        </svg>
    </button>
    <div id="ai-chat-widget" class="ai-chat-widget">
        <div class="chat-header">
            <h3 class="text-slate-800">עוזר AI</h3>
            <button class="chat-close-btn" id="chat-close-btn">&times;</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-message assistant">שלום! אני העוזר הדיגיטלי שלך. איך אפשר לעזור היום?</div>
        </div>
        <form class="chat-form" id="chat-form">
            <input type="text" id="chat-input" class="chat-input" placeholder="שאל אותי משהו..." autocomplete="off">
            <button type="submit" id="chat-send-btn" class="chat-send-btn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
            </button>
        </form>
    </div>
    <!-- END: AI ASSISTANT -->

    <!-- Subscription Banner -->
    <div id="subscription-banner" class="subscription-banner hidden">
        <span id="banner-text"></span>
        <button id="banner-button" class="ml-4 bg-white text-blue-600 px-4 py-1 rounded-full font-bold hover:bg-gray-100 transition-colors">
            לשדרוג לחץ כאן
        </button>
    </div>

    <!-- Scroll Navigation -->
    <div class="scroll-nav hidden lg:flex" id="scroll-nav">
        <button onclick="scrollTable('up')" title="גלול למעלה">↑</button>
        <button onclick="scrollTable('down')" title="גלול למטה">↓</button>
        <button onclick="scrollTable('left')" title="גלול שמאלה">←</button>
        <button onclick="scrollTable('right')" title="גלול ימינה">→</button>
    </div>

    <!-- VAT Setup Modal -->
    <div id="vat-setup-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <h3 class="modal-title !text-white">הגדרת מע"מ ועסק</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">סוג העסק:</label>
                    <select id="business-type" class="w-full px-3 py-2 border rounded-lg bg-slate-700 border-slate-600 text-slate-200">
                        <option value="company">חברה בע"מ</option>
                        <option value="authorized">עוסק מורשה</option>
                        <option value="exempt">עוסק פטור</option>
                    </select>
                </div>
                <div id="vat-settings-section">
                    <div>
                        <label class="block text-sm font-medium mb-2">תדירות דיווח מע"מ:</label>
                        <select id="vat-frequency" class="w-full px-3 py-2 border rounded-lg bg-slate-700 border-slate-600 text-slate-200">
                            <option value="monthly">חד חודשי</option>
                            <option value="bimonthly">דו חודשי</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">באיזה יום בחודש אתה משלם מע"מ?</label>
                        <input type="number" id="vat-payment-day" class="w-full px-3 py-2 border rounded-lg bg-slate-700 border-slate-600 text-slate-200" min="1" max="31" value="15" placeholder="15">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">האם בעסק שלך יש הכנסות פטורות ממע"מ?</label>
                        <select id="has-exempt-income" class="w-full px-3 py-2 border rounded-lg bg-slate-700 border-slate-600 text-slate-200">
                            <option value="no">לא</option>
                            <option value="yes">כן</option>
                        </select>
                    </div>
                </div>
                <button id="save-vat-settings" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    שמור הגדרות
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="auth-container" class="hidden min-h-screen flex items-center justify-center">
        <div class="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-slate-700">
            <h2 id="auth-title" class="text-3xl font-bold text-white text-center mb-6">התחברות</h2>
            <div id="auth-message" class="bg-red-800/30 border border-red-700 text-red-300 px-4 py-3 rounded-lg relative mb-4 hidden" role="alert"></div>
            
            <form id="auth-form">
                <input type="email" id="email" class="w-full px-4 py-3 border rounded-lg mb-4 bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" placeholder="אימייל" required>
                <input type="password" id="password" class="w-full px-4 py-3 border rounded-lg mb-4 bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200" placeholder="סיסמה" required>
                
                <div id="terms-container" class="mt-4 hidden">
                    <label class="flex items-center text-sm">
                        <input type="checkbox" id="terms-checkbox" class="ml-2 h-4 w-4 text-blue-500 border-slate-600 rounded focus:ring-blue-500 bg-slate-700">
                        <span class="text-slate-400">קראתי ואני מסכים ל<a href="#" target="_blank" class="text-blue-400 hover:underline mx-1">תנאי השימוש</a> ול<a href="#" target="_blank" class="text-blue-400 hover:underline mx-1">מדיניות הפרטיות</a>.</span>
                    </label>
                </div>

                <button type="submit" id="auth-submit-btn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 mt-6 font-semibold text-lg shadow-lg transition-all duration-200">התחבר</button>
            </form>
            
            <div class="text-center mt-6 text-sm flex justify-between">
                <a href="#" id="forgot-password-link" class="text-slate-400 hover:text-slate-300 hover:underline transition-colors duration-200">שכחת סיסמה?</a>
                <a href="#" id="toggle-auth-mode" class="text-blue-400 hover:text-blue-300 hover:underline transition-colors duration-200">אין לך חשבון? הירשם כאן</a>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container" class="hidden container mx-auto p-4 md:p-8">
        <header class="mb-8 text-center no-print flex flex-col sm:flex-row justify-between items-center relative">
            <!-- Theme Toggle Button (Sun/Moon icon) -->
            <button id="theme-toggle" class="absolute top-0 left-0 p-2 rounded-full bg-slate-700 hover:bg-slate-600 text-slate-300 transition-colors duration-200 z-10">
                <i class="fas fa-sun text-xl" id="sun-icon"></i>
                <i class="fas fa-moon text-xl hidden" id="moon-icon"></i>
            </button>

            <div class="flex flex-col sm:flex-row gap-2 mb-4 sm:mb-0 z-10"> <!-- Added z-10 -->
                 <button id="logout-btn" class="action-button bg-red-600 hover:bg-red-700 text-white">
                    <i class="fas fa-sign-out-alt ml-2"></i> התנתק
                 </button>
                 <button id="header-save-btn" class="action-button bg-green-600 hover:bg-green-700 text-white">
                    <i class="fas fa-save ml-2"></i> שמור
                 </button>
                 <button id="settings-btn" class="action-button bg-slate-600 hover:bg-slate-700 text-white">
                    <i class="fas fa-cog ml-2"></i> הגדרות
                 </button>
                 <button id="dashboard-btn" class="action-button bg-purple-600 hover:bg-purple-700 text-white">
                    <i class="fas fa-chart-line ml-2"></i> דשבורד ניהולי
                 </button>
            </div>
            <div class="flex-grow">
                 <div class="year-nav justify-center">
                     <button id="prev-year-btn" class="nav-button">
                        <i class="fas fa-chevron-right"></i>
                     </button>
                     <h2 id="current-year-display" class="text-xl font-bold mx-4 text-white"></h2>
                     <button id="next-year-btn" class="nav-button">
                        <i class="fas fa-chevron-left"></i>
                     </button>
                 </div>
                 <h1 class="text-3xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">תזרים מזומנים יומי</h1>
                 <input type="text" id="clientName" placeholder="הקלד שם לקוח כאן" class="mt-2 text-center text-xl font-semibold bg-slate-700 border-slate-600 text-white placeholder-slate-400 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
            </div>
            <button id="todayButtonHeader" class="action-button bg-yellow-500 hover:bg-yellow-600 text-white">
                <i class="fas fa-calendar-day ml-2"></i> היום (<span id="todayDateDisplay"></span>)
            </button>
        </header>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 no-print">
            <!-- Card 1: Monthly Balance -->
            <div class="summary-card flex flex-col justify-between p-0 overflow-hidden bg-slate-800/60 border border-slate-700 rounded-xl shadow-lg">
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">הכנסות (חודשי)</h4>
                    <p id="dashboard-income" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">הוצאות (חודשי)</h4>
                    <p id="dashboard-expense" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                    <h4 class="text-sm font-semibold text-slate-400">מאזן (חודשי)</h4>
                    <p id="dashboard-balance" class="text-2xl lg:text-3xl font-bold text-blue-400">0 ₪</p>
                </div>
            </div>
            
            <!-- Card 2: Salaries -->
            <div class="summary-card flex flex-col justify-between p-0 overflow-hidden bg-slate-800/60 border border-slate-700 rounded-xl shadow-lg">
                 <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">עלות שכר עבודה (חודשי)</h4>
                    <p id="dashboard-employee-wages" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 id="owner-cost-label" class="text-sm font-semibold text-slate-400">שכר בעלים/שליטה (חודשי)</h4>
                    <p id="dashboard-owner-wages" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                    <h4 class="text-sm font-semibold text-slate-400">עלות משכורות כוללת</h4>
                    <p id="dashboard-total-wages" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
            </div>
            
            <!-- Card 3: Loans -->
            <div class="summary-card flex flex-col justify-between p-0 overflow-hidden bg-slate-800/60 border border-slate-700 rounded-xl shadow-lg">
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">עלות הלוואות (חודשי)</h4>
                    <p id="dashboard-total-loans" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">הלוואות ששולמו</h4>
                    <p id="dashboard-paid-loans" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                    <h4 class="text-sm font-semibold text-slate-400">נותר לשלם (עד סוף חודש)</h4>
                    <p id="dashboard-remaining-loans" class="text-2xl lg:text-3xl font-bold text-red-400">0 ₪</p>
                </div>
            </div>

            <!-- Card 4: New Dashboard Metrics (Opening Balance, Rolling Balance, Bank Limit, Balance vs Limit) -->
            <div class="summary-card flex flex-col justify-between p-0 overflow-hidden bg-slate-800/60 border border-slate-700 rounded-xl shadow-lg">
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">יתרת פתיחה לחודש</h4>
                    <p id="dashboard-opening-balance" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">מאזן יומי מתגלגל (היום)</h4>
                    <p id="dashboard-rolling-balance" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4 border-b border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-400">מסגרת בנק</h4>
                    <p id="dashboard-bank-limit" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
                <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                    <h4 class="text-sm font-semibold text-slate-400">יתרה / חריגה ממסגרת</h4>
                    <p id="dashboard-balance-vs-limit" class="text-2xl lg:text-3xl font-bold text-green-400">0 ₪</p>
                </div>
            </div>
        </div>
        
        <div class="mb-6 bg-slate-800/60 p-2 rounded-xl shadow-lg overflow-x-auto no-print border border-slate-700">
            <nav id="month-tabs" class="flex space-x-1 md:space-x-2 space-x-reverse justify-center"></nav>
        </div>

        <div class="hidden lg:block bg-slate-800/60 rounded-xl shadow-lg overflow-hidden main-table-container relative no-print border border-slate-700">
            <!-- START: Fullscreen Button -->
            <button id="toggle-fullscreen-btn" title="הצג מסך מלא" class="absolute top-4 left-4 z-20 p-2 bg-slate-700 rounded-full hover:bg-slate-600 text-slate-300 transition-colors duration-200">
                <svg id="expand-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5" />
                </svg>
                <svg id="collapse-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 14l-5 5m0 0v-4m0 4h4m1-11l5-5m0 0v4m0-4h-4m-1 11l5 5m0 0v-4m0 4h-4m-7-1l-5-5m0 0v4m0-4h4" />
                </svg>
            </button>
            <!-- END: Fullscreen Button -->
            <div class="table-container" id="table-container">
                <table class="w-full text-sm text-center border-collapse">
                    <thead id="table-head"></thead>
                    <tbody id="table-body"></tbody>
                    <tfoot id="table-foot"></tfoot>
                </table>
            </div>
        </div>
        
        <div class="block lg:hidden bg-slate-800/60 rounded-xl shadow-lg overflow-hidden no-print border border-slate-700" id="mobile-view-container"></div>

        <div class="mt-8 flex flex-wrap justify-center items-center gap-4 md:gap-6 no-print">
             <button id="saveButton" class="action-button bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white">
                <i class="fas fa-check-circle ml-2"></i> שמור
             </button>
             <button id="todayButton" class="action-button bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white">
                <i class="fas fa-calendar-day ml-2"></i> היום
             </button>
             <!-- Removed old copy buttons -->
             <!--
             <button id="copyFixedButton" class="action-button bg-gradient-to-r from-indigo-500 to-violet-600 hover:from-indigo-600 hover:to-violet-700 text-white">
                <i class="fas fa-copy ml-2"></i> העתק קבועות
             </button>
             <button id="copyTaxesButton" class="action-button bg-gradient-to-r from-purple-500 to-fuchsia-600 hover:from-purple-600 hover:to-fuchsia-700 text-white">
                <i class="fas fa-file-invoice-dollar ml-2"></i> העתק מיסים
             </button>
             <button id="copyTitlesButton" class="action-button bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white">
                <i class="fas fa-pen-nib ml-2"></i> העתק כותרות
             </button>
             -->
             <button id="printButton" class="action-button bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white">
                <i class="fas fa-print ml-2"></i> הדפס / PDF
             </button>
             <button id="resetButton" class="action-button bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white">
                <i class="fas fa-undo ml-2"></i> אפס חודש
             </button>
             <button id="cashflowGapButton" class="action-button bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white">
                <i class="fas fa-exclamation-triangle ml-2"></i> בדיקת פער תזרימי
             </button>
        </div>

        <!-- Contact Footer -->
        <div class="contact-footer no-print bg-slate-800/60 border border-slate-700 rounded-xl shadow-lg text-slate-300">
            <h3 class="text-xl font-bold mb-2 text-white">צור קשר</h3>
            <p class="text-slate-400 mb-3">יש לכם שאלות או הצעות לשיפור?</p>
            <a href="mailto:support@gilfinnas.com?subject=פנייה מאפליקציית תזרים מזומנים&body=שלום," class="contact-link text-blue-400 hover:text-blue-300">
                <i class="fas fa-envelope ml-2"></i> שלחו לנו מייל
            </a>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <div class="modal-header flex justify-between items-center pb-4 border-b border-slate-700">
                <h3 class="modal-title !text-white !mb-0">הגדרות</h3>
                <button id="close-settings" class="text-slate-400 hover:text-slate-200 text-3xl leading-none">&times;</button>
            </div>
            <div class="modal-body-scrollable custom-scrollbar">
                <!-- General Settings Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">הגדרות כלליות</h4>
                        <p class="settings-card-subtitle">הגדרות התנהגות אפליקציה</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">שמירת נתונים אוטומטית</div>
                                <p class="settings-item-description">השינויים יישמרו אוטומטית 2 שניות לאחר ההקלדה</p>
                            </div>
                            <div class="settings-item-control">
                                <div class="toggle-switch" id="auto-save-toggle">
                                    <div class="toggle-knob"></div>
                                    <input type="checkbox" id="auto-save-checkbox" class="sr-only">
                                </div>
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">התראות תזרים אוטומטיות</div>
                                <p class="settings-item-description">הצג סימן אזהרה בימים עם חריגה צפויה</p>
                            </div>
                            <div class="settings-item-control">
                                <div class="toggle-switch" id="auto-alerts-toggle">
                                    <div class="toggle-knob"></div>
                                    <input type="checkbox" id="auto-alerts-checkbox" class="sr-only">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Settings Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">הגדרות פיננסיות</h4>
                        <p class="settings-card-subtitle">יתרות פתיחה ומסגרות בנק</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">יתרת פתיחה שנתית</div>
                                <p class="settings-item-description">יתרת המזומנים בתחילת השנה</p>
                            </div>
                            <div class="settings-item-control">
                                <input type="text" inputmode="decimal" id="settings-openingBalance" class="formatted-number-input" value="10,000" style="width: 120px;">
                            </div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">מסגרת בנק</div>
                                <p class="settings-item-description">מסגרת אשראי בבנק (אופציונלי)</p>
                            </div>
                            <div class="settings-item-control">
                                <input type="text" inputmode="decimal" id="settings-bankLimit" class="formatted-number-input" placeholder="0" style="width: 120px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Settings Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">הגדרות חשבון</h4>
                        <p class="settings-card-subtitle">סיסמה ואימות דו-שלבי</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">שינוי סיסמה</div>
                                <p class="settings-item-description">עדכון סיסמת החשבון</p>
                            </div>
                        </div>
                        <div style="padding: 0 25px;">
                            <input type="password" id="new-password" class="w-full px-3 py-2 border rounded bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 mb-2" placeholder="סיסמה חדשה">
                            <input type="password" id="confirm-password" class="w-full px-3 py-2 border rounded bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 mb-3" placeholder="אשר סיסמה חדשה">
                            <button id="change-password-btn" class="action-button bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 mb-4">שנה סיסמה</button>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">אימות דו-שלבי</div>
                                <p class="settings-item-description">הגנה נוספת על החשבון</p>
                            </div>
                        </div>
                        <div style="padding: 0 25px;">
                            <div id="phone-number-display" class="mb-2 p-2 bg-green-800/30 text-green-300 rounded-lg hidden">
                                <span class="font-semibold">מספר מאומת: </span><span id="verified-phone"></span>
                            </div>
                            <input type="tel" id="phone-number" class="w-full px-3 py-2 border rounded bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 mb-2" placeholder="מספר טלפון (לדוגמה: +972501234567)">
                            <div id="recaptcha-container" class="my-3"></div>
                            <button id="send-verification-code" class="action-button bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 mb-2">שלח קוד אימות</button>
                            <div id="verification-code-area" class="hidden mt-3">
                                <input type="text" id="verification-code" class="w-full px-3 py-2 border rounded bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 mb-2" placeholder="קוד אימות בן 6 ספרות" maxlength="6">
                                <button id="verify-phone" class="action-button bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 mb-2">אמת מספר טלפון</button>
                            </div>
                            <button id="remove-2fa" class="action-button bg-red-600 text-white hover:bg-red-700 transition-colors duration-200 hidden">הסר אימות דו-שלבי</button>
                        </div>
                    </div>
                </div>

                <!-- Business Settings Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">הגדרות עסק ומע"מ</h4>
                        <p class="settings-card-subtitle">הגדרות מע"מ ומבנה עסק</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">הגדרות מע"מ</div>
                                <p class="settings-item-description">סוג עסק ותדירות דיווח</p>
                            </div>
                            <div class="settings-item-control">
                                <button id="edit-vat-settings" class="action-button bg-yellow-600 text-white hover:bg-yellow-700 transition-colors duration-200">ערוך הגדרות</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Management Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">ניהול קטגוריות</h4>
                        <p class="settings-card-subtitle">עריכת שורות וקטגוריות</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">עריכת קטגוריות</div>
                                <p class="settings-item-description">הוספה, עריכה ומחיקה של קטגוריות</p>
                            </div>
                            <div class="settings-item-control">
                                <button id="edit-categories-btn" class="action-button bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200">ערוך קטגוריות</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Copy Settings Card -->
                <div class="settings-card">
                    <div class="settings-card-header">
                        <h4 class="settings-card-title">הגדרות העתקה חודשית</h4>
                        <p class="settings-card-subtitle">העתקת נתונים בין חודשים</p>
                    </div>
                    <div class="settings-card-body">
                        <div class="settings-item">
                            <div class="settings-item-label">
                                <div class="settings-item-title">הגדרות העתקה</div>
                                <p class="settings-item-description">הגדרת נתונים להעתקה בין חודשים</p>
                            </div>
                            <div class="settings-item-control">
                                <button id="open-copy-settings-btn" class="action-button bg-purple-600 text-white hover:bg-purple-700 transition-colors duration-200">ערוך הגדרות</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- The traditional save button will be outside the scrollable area if needed, or removed if auto-save is primary -->
            <!-- <div class="mt-6 text-center">
                 <button id="save-settings-btn-bottom" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors duration-200">שמור הגדרות</button>
            </div> -->
        </div>
    </div>
    
    <!-- Category Editor Modal -->
    <div id="category-editor-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <div class="modal-header flex justify-between items-center pb-4 border-b border-slate-700">
                <h3 class="modal-title !text-white !mb-0">עריכת קטגוריות</h3>
                <button id="cancel-category-edit" class="text-slate-400 hover:text-slate-200 text-3xl leading-none">&times;</button>
            </div>
            <div id="category-editor-container" class="space-y-4 max-h-96 overflow-y-auto pr-2 custom-scrollbar">
                <!-- Categories will be rendered here by JS -->
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button id="save-category-changes" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-200">שמור שינויים</button>
            </div>
        </div>
    </div>

    <!-- NEW: Copy Settings Modal -->
    <div id="copy-settings-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <div class="modal-header flex justify-between items-center pb-4 border-b border-slate-700">
                <h3 class="modal-title !text-white !mb-0">הגדרות העתקה חודשית</h3>
                <button id="close-copy-settings-btn" class="text-slate-400 hover:text-slate-200 text-3xl leading-none">&times;</button>
            </div>
            <div class="modal-body-scrollable custom-scrollbar">
                <p class="text-slate-400 text-sm mb-4">בחר אילו קטגוריות וסכומים יועתקו מחודש קודם לחודש הנוכחי.</p>
                
                <!-- Global Copy Options -->
                <div class="pb-4 border-b border-slate-700">
                    <h4 class="text-lg font-semibold mb-3 text-white">הגדרות העתקה כלליות</h4>
                    <div>
                        <label class="flex items-center cursor-pointer mb-3">
                            <div class="relative">
                                <input type="checkbox" id="copy-fixed-expenses-checkbox" class="sr-only">
                                <div class="block bg-slate-700 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-slate-400 w-6 h-6 rounded-full transition-all duration-300"></div>
                            </div>
                            <div class="ml-3 text-slate-300 font-medium">העתק הוצאות קבועות והלוואות (סכומים)</div>
                        </label>
                        <p class="text-xs text-slate-500 mt-1 mr-4">מעתיק סכומים מקטגוריות "הוצאות קבועות" ו"הלוואות" מחודש קודם.</p>
                    </div>
                    <div class="mt-3">
                        <label class="flex items-center cursor-pointer mb-3">
                            <div class="relative">
                                <input type="checkbox" id="copy-taxes-checkbox" class="sr-only">
                                <div class="block bg-slate-700 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-slate-400 w-6 h-6 rounded-full transition-all duration-300"></div>
                            </div>
                            <div class="ml-3 text-slate-300 font-medium">העתק מיסים ותשלומים (סכומים)</div>
                        </label>
                        <p class="text-xs text-slate-500 mt-1 mr-4">מעתיק סכומים מקטגוריות "תשלומים ומיסים" (למעט מע"מ מחושב) מחודש קודם.</p>
                    </div>
                    <div class="mt-3">
                        <label class="flex items-center cursor-pointer">
                            <div class="relative">
                                <input type="checkbox" id="copy-titles-checkbox" class="sr-only">
                                <div class="block bg-slate-700 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-slate-400 w-6 h-6 rounded-full transition-all duration-300"></div>
                            </div>
                            <div class="ml-3 text-slate-300 font-medium">העתק כותרות מותאמות אישית</div>
                        </label>
                        <p class="text-xs text-slate-500 mt-1 mr-4">מעתיק שמות מותאמים אישית של שורות (לדוגמה: שמות ספקים, הלוואות) מחודש קודם.</p>
                    </div>
                </div>

                <!-- Granular Copy Options (New Section) -->
                <div class="mt-4">
                    <h4 class="text-lg font-semibold mb-3 text-white">העתקת כותרות וסכומים לפי קטגוריה</h4>
                    <p class="text-xs text-slate-500 mb-4">בחר אילו שורות ספציפיות יועתקו עם סכומיהן (אם יש) או רק את כותרותיהן.</p>
                    <div id="granular-copy-options-container" class="space-y-3">
                        <!-- Categories and their items will be dynamically loaded here by JS -->
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button id="close-copy-settings-btn" class="px-4 py-2 bg-slate-700 text-slate-200 rounded hover:bg-slate-600 transition-colors duration-200">ביטול</button>
                <button id="save-copy-settings-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-200">שמור הגדרות</button>
                <button id="apply-copy-settings-btn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors duration-200">הפעל העתקה לחודש הנוכחי</button>
            </div>
        </div>
    </div>


    <!-- Subscription Expired Modal -->
    <div id="subscription-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200 text-center">
            <h3 class="modal-title !text-red-400">המנוי שלך פג</h3>
            <p class="modal-body !text-slate-300 mb-6">הגישה שלך לאפליקציה הסתיימה. כדי להמשיך ליהנות מהשירות, אנא שדרג את המנוי שלך.</p>
            <button id="upgrade-now-btn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg hover:from-green-600 hover:to-emerald-700 font-bold text-lg mb-3 transition-all duration-200">
                🚀 שדרג עכשיו
            </button>
            <button id="logout-from-expired" class="w-full bg-slate-600 text-white py-2 rounded-lg hover:bg-slate-700 transition-colors duration-200">התנתק</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast no-print"></div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <h3 id="custom-alert-title" class="modal-title !text-white">הודעה</h3>
            <p id="custom-alert-body" class="modal-body !text-slate-300"></p>
            <div class="modal-actions !justify-center">
                <button id="custom-alert-ok-btn" class="modal-button modal-button-ok !bg-blue-600 hover:!bg-blue-700">אישור</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content !bg-slate-800 !border !border-slate-700 !text-slate-200">
            <h3 id="custom-confirm-title" class="modal-title !text-white">אישור פעולה</h3>
            <p id="custom-confirm-body" class="modal-body !text-slate-300"></p>
            <div class="modal-actions !justify-center">
                <button id="custom-confirm-cancel-btn" class="modal-button modal-button-cancel !bg-slate-700 hover:!bg-slate-600 !text-slate-200">ביטול</button>
                <button id="custom-confirm-ok-btn" class="modal-button modal-button-confirm !bg-blue-600 hover:!bg-blue-700">אישור</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
